<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>All Green Room Lists</title>
    <style>
        body { font-family: DejaVu Sans, sans-serif; font-size: 12px; }
        h2, h3 { text-align: center; margin: 5px 0; }
        table { width: 100%; border-collapse: collapse; margin: 15px 0; table-layout: fixed; page-break-inside: avoid; }
        th, td { border: 1px solid #000; padding: 5px; text-align: center; word-wrap: break-word; }

        th { background: #f2f2f2; }
        .page-break { page-break-after: always; }
    </style>
</head>
<body>
    <h2>All Green Room Lists</h2>
    {% if is_team_user %}
        <p><strong>Team:</strong> {{ team_name }}</p>
    {% endif %}

    {% regroup program_participants by program.category.name as category_list %}

    {% for category in category_list %}
        <h3>{{ category.grouper }}</h3>
        
        {% for item in category.list %}
            <h4>{{ item.program.name }}</h4>
            {% if item.participants %}
                <table>
                    <thead>
                        <tr>
                            <th style="width: 60px;">Chest No</th>
                            <th style="width: 150px;">Name</th>
                            <th style="width: 90px;">Category</th>
                            {% if not is_team_user %}
                                <th style="width: 150px;">Team</th>
                            {% endif %}
                            <th style="width: 70px;">Code Letter</th>
                            <th style="width: 80px;">Signature</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for p in item.participants %}
                            <tr>
                                <td style="width: 60px;">{{ p.chest_no }}</td>
                                <td style="width: 150px;">{{ p.name }}</td>
                                <td style="width: 90px;">{{ p.category.name }}</td>
                                {% if not is_team_user %}
                                    <td style="width: 150px;">{{ p.team.name }}</td>
                                {% endif %}
                                <td style="width: 70px;"></td>
                                <td style="width: 80px;"></td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <p>No participants found.</p>
            {% endif %}
        {% endfor %}

        <div class="page-break"></div>
    {% endfor %}
</body>
</html>

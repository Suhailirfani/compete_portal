
<!-- templates/competition/group_participation_form.html -->
<!DOCTYPE html>
<html>
<head>
    <title>Create Group Participation</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        select, input { width: 300px; padding: 8px; }
        button { background: #007bff; color: white; padding: 10px 20px; border: none; cursor: pointer; }
        button:hover { background: #0056b3; }
        .contestant-list { max-height: 200px; overflow-y: auto; border: 1px solid #ddd; padding: 10px; }
        .contestant-item { margin-bottom: 5px; }
        .messages { margin-bottom: 20px; }
        .alert { padding: 10px; margin-bottom: 10px; border-radius: 4px; }
        .alert-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .alert-error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    </style>
</head>
<body>
    <h1>Create Group Participation</h1>
    
    {% if messages %}
        <div class="messages">
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }}">{{ message }}</div>
            {% endfor %}
        </div>
    {% endif %}
    
    <form method="post">
        {% csrf_token %}
        
        <div class="form-group">
            <label for="program_id">Select Group Program:</label>
            <select name="program_id" id="program_id" required>
                <option value="">-- Select Program --</option>
                {% for program in programs %}
                    <option value="{{ program.id }}" data-min="{{ program.min_participants }}" data-max="{{ program.max_participants }}">
                        {{ program.name }} ({{ program.min_participants }}-{{ program.max_participants }} participants)
                    </option>
                {% endfor %}
            </select>
        </div>
        
        <div class="form-group">
            <label for="team_filter">Filter by Team:</label>
            <select id="team_filter">
                <option value="">-- All Teams --</option>
                {% for team in teams %}
                    <option value="{{ team.id }}">{{ team.name }}</option>
                {% endfor %}
            </select>
        </div>
        
        <div class="form-group">
            <label>Select Contestants:</label>
            <div class="contestant-list" id="contestant-list">
                {% for contestant in contestants %}
                    <div class="contestant-item" data-team="{{ contestant.team.id }}">
                        <input type="checkbox" name="contestants" value="{{ contestant.id }}" id="contestant_{{ contestant.id }}">
                        <label for="contestant_{{ contestant.id }}">
                            {{ contestant.name }} ({{ contestant.team.name }}) - Chest No: {{ contestant.chest_no }}
                        </label>
                    </div>
                {% endfor %}
            </div>
        </div>
        
        <div class="form-group">
            <label for="group_name">Group Name (Optional):</label>
            <input type="text" name="group_name" id="group_name" placeholder="e.g., Team Alpha Singers">
        </div>
        
        <button type="submit">Create Group</button>
        <a href="{% url 'group_participation_list' %}">Back to List</a>
    </form>
    
    <script>
        // Team filter functionality
        document.getElementById('team_filter').addEventListener('change', function() {
            const teamId = this.value;
            const contestants = document.querySelectorAll('.contestant-item');
            
            contestants.forEach(item => {
                if (teamId === '' || item.dataset.team === teamId) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                    // Uncheck hidden contestants
                    item.querySelector('input[type="checkbox"]').checked = false;
                }
            });
        });
        
        // Validate participant count based on program selection
        document.getElementById('program_id').addEventListener('change', function() {
            const option = this.options[this.selectedIndex];
            const min = parseInt(option.dataset.min) || 1;
            const max = parseInt(option.dataset.max) || 1;
            
            // Update form validation
            window.minParticipants = min;
            window.maxParticipants = max;
        });
        
        // Validate form submission
        document.querySelector('form').addEventListener('submit', function(e) {
            const checkedBoxes = document.querySelectorAll('input[name="contestants"]:checked');
            const count = checkedBoxes.length;
            
            if (window.minParticipants && window.maxParticipants) {
                if (count < window.minParticipants || count > window.maxParticipants) {
                    e.preventDefault();
                    alert(`Please select between ${window.minParticipants} and ${window.maxParticipants} contestants.`);
                    return;
                }
            }
            
            // Check if all contestants are from same team
            const teams = new Set();
            checkedBoxes.forEach(box => {
                const contestantItem = box.closest('.contestant-item');
                teams.add(contestantItem.dataset.team);
            });
            
            if (teams.size > 1) {
                e.preventDefault();
                alert('All contestants must be from the same team.');
                return;
            }
        });
    </script>
</body>
</html>
